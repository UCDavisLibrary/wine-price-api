version: '2'

volumes:
  winedb:

services:
 postgres:
#  image: wine-postgres
  build: ./postgres
  volumes:
    - winedb:/var/lib/postgresql/data
    - ./:/app
  environment:
    POSTGRES_DB: wine_price_dev
    POSTGRES_USER: postgres

 postgrest:
#  image: begriffs/postgrest:latest
  build: ./postgrest
  volumes:
    - ./config/postgrest.conf:/etc/postgrest.conf
  ports:
    - "3001:3000"
  links:
    - postgres:postgres

 nginx:
#  image: nginx:alpine
  image: nginx
  volumes:
   - .:/app
  ports:
   - "8080:80"
  environment:
   - NGINX_HOST=api.catalogs.qjhart.org
   - NGINX_PORT=80
  links:
    - postgrest:postgrest
  command: /bin/bash -c "envsubst < /app/config/nginx_envsubst.conf > /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'"
